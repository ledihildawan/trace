<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Grid Architect V53 - Mobile DVH</title>
    <style>
      :root {
        --bg: #fdfdfe;
        --grid-bg: #f1f5f9;
        --border: #e2e8f0;
        --cell-bg: #ffffff;
        --text-main: #0f172a;
        --text-muted: #94a3b8;
        --accent: #6366f1;
        --cyan: #22d3ee;
        --weekend-bg: #f5f3ff;
        --weekend-text: #8b5cf6;
        --today-bg: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
        --month-start-bg: #f0f9ff;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-font-smoothing: antialiased;
        user-select: none;
        -webkit-user-select: none;
        -webkit-tap-highlight-color: transparent;
      }

      html,
      body {
        /* Menggunakan dvh untuk akurasi full screen di mobile */
        height: 100dvh;
        width: 100vw;
        background: var(--bg);
        color: var(--text-main);
        font-family: 'Inter', system-ui, sans-serif;
        overflow: hidden;
        overscroll-behavior: none;
      }

      #viewport {
        width: 100vw;
        height: 100dvh;
        overflow-y: auto;
        scroll-snap-type: y mandatory;
        scrollbar-width: none;
        position: relative;
        transform: translateZ(0);
      }
      #viewport::-webkit-scrollbar {
        display: none;
      }

      #infinite-canvas {
        position: relative;
        width: 100%;
        contain: paints;
      }

      .year-block {
        position: absolute;
        left: 0;
        width: 100vw;
        height: 100dvh;
        scroll-snap-align: start;
        scroll-snap-stop: always;
        display: flex;
        overflow: hidden;
        contain: strict;
      }

      .grid-container {
        position: relative;
        flex: 1;
        display: flex;
        background: var(--bg);
      }

      .watermark-embedded {
        position: absolute;
        top: 0;
        right: 6%;
        height: 100%;
        display: flex;
        align-items: center;
        font-size: 32dvh;
        font-weight: 950;
        color: transparent;
        background: linear-gradient(180deg, rgba(99, 102, 241, 0.15), rgba(34, 211, 238, 0.15), transparent);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-stroke: 1px rgba(148, 163, 184, 0.05);
        writing-mode: vertical-rl;
        pointer-events: none;
        z-index: 5;
        white-space: nowrap;

        opacity: 0;
        letter-spacing: -3dvh;
        transform: translateY(60px) scale(0.9) translateZ(0);
        transition: opacity 1.4s cubic-bezier(0.2, 1, 0.3, 1), transform 1.4s cubic-bezier(0.2, 1, 0.3, 1),
          letter-spacing 1.6s cubic-bezier(0.2, 1, 0.3, 1);
        /* will-change diatur lewat JS hanya saat dibutuhkan untuk hemat baterai */
      }

      .year-block.active .watermark-embedded {
        opacity: 1;
        transform: translateY(0) scale(1) translateZ(0);
        letter-spacing: -2dvh;
      }

      .grid-layer {
        position: relative;
        z-index: 2;
        display: grid;
        gap: 1px;
        background: var(--border);
        width: 100%;
        height: 100%;
        opacity: 0;
        transform: scale(1.02) translateZ(0);
        transition: opacity 0.8s ease-out, transform 1s cubic-bezier(0.2, 1, 0.3, 1);
      }

      .year-block.active .grid-layer {
        opacity: 1;
        transform: scale(1) translateZ(0);
      }

      .cell {
        background: var(--cell-bg);
        position: relative;
      }

      .cell-content {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
        height: 100%;
        padding: 12% 0;
        text-align: center;
        contain: layout style;
      }

      .cell .info-meta {
        font-size: clamp(5px, 0.8dvh, 7.5px);
        text-transform: uppercase;
        color: var(--text-muted);
        font-weight: 800;
        letter-spacing: 0.12em;
      }

      .cell .date-num {
        font-size: clamp(14px, 2.8dvh, 22px);
        font-weight: 900;
        line-height: 1;
      }

      .cell.filler {
        background: var(--bg);
        opacity: 0.15;
      }
      .cell.weekend {
        background: var(--weekend-bg);
      }
      .cell.weekend .date-num,
      .cell.weekend .info-meta {
        color: var(--weekend-text);
      }
      .cell.month-start {
        background: var(--month-start-bg);
        box-shadow: inset 4px 0 0 var(--cyan);
      }

      .cell.today {
        background: var(--today-bg) !important;
        z-index: 10;
        box-shadow: 0 8px 20px -5px rgba(79, 70, 229, 0.4);
      }
      .cell.today .date-num,
      .cell.today .info-meta {
        color: #fff !important;
      }

      .cell:not(.filler):hover {
        background: #f8fafc;
        transition: background 0.2s ease;
      }
    </style>
  </head>
  <body>
    <main id="viewport">
      <div id="infinite-canvas"></div>
    </main>

    <script>
      const Viewport = document.getElementById('viewport');
      const Canvas = document.getElementById('infinite-canvas');

      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Ags', 'Sep', 'Okt', 'Nov', 'Des'];
      const daysLabel = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];

      const today = new Date();
      const startVirtualYear = today.getFullYear();

      const YEAR_HEIGHT = window.innerHeight;
      const TOTAL_VIRTUAL_YEARS = 1000;
      const START_Y = (TOTAL_VIRTUAL_YEARS / 2) * YEAR_HEIGHT;

      let activeYears = new Map();
      let isTicking = false;

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            window.requestAnimationFrame(() => {
              if (entry.isIntersecting) entry.target.classList.add('active');
              else entry.target.classList.remove('active');
            });
          });
        },
        { threshold: 0.1 }
      );

      function isLeap(y) {
        return (y % 4 === 0 && y % 100 !== 0) || y % 400 === 0;
      }

      function createYearBlock(year, yPos) {
        if (activeYears.has(year)) return;
        const block = document.createElement('section');
        block.className = 'year-block';
        block.style.top = `${yPos}px`;

        const firstDayOfYear = new Date(year, 0, 1).getDay();
        const totalDays = isLeap(year) ? 366 : 365;
        const cols = Math.ceil(Math.sqrt(365 * (window.innerWidth / window.innerHeight)));
        const rows = Math.ceil((totalDays + firstDayOfYear) / cols);

        let gridHTML = `<div class="grid-container">
                <div class="watermark-embedded">${year}</div>
                <div class="grid-layer" style="grid-template-columns: repeat(${cols}, 1fr); grid-template-rows: repeat(${rows}, 1fr);">`;

        for (let s = 0; s < cols * rows; s++) {
          const targetDate = new Date(year, 0, 1);
          targetDate.setDate(targetDate.getDate() + (s - firstDayOfYear));

          const d = targetDate.getDate();
          const m = targetDate.getMonth();
          const dy = targetDate.getDay();
          const isThisYear = targetDate.getFullYear() === year;

          let classes = ['cell'];
          if (!isThisYear) classes.push('filler');
          else {
            if (d === 1) classes.push('month-start');
            if (dy === 0 || dy === 6) classes.push('weekend');
            if (targetDate.toDateString() === today.toDateString()) classes.push('today');
          }

          gridHTML += `
                    <div class="${classes.join(' ')}">
                        <div class="cell-content">
                            <span class="info-meta">${months[m]}</span>
                            <span class="date-num">${d}</span>
                            <span class="info-meta">${daysLabel[dy]}</span>
                        </div>
                    </div>`;
        }

        gridHTML += `</div></div>`;
        block.innerHTML = gridHTML;
        Canvas.appendChild(block);
        activeYears.set(year, block);
        observer.observe(block);
      }

      function updateInfinite() {
        const scrollTop = Viewport.scrollTop;
        const currentIdx = Math.round(scrollTop / YEAR_HEIGHT);
        const currentYear = startVirtualYear + (currentIdx - TOTAL_VIRTUAL_YEARS / 2);

        for (let i = -1; i <= 1; i++) {
          createYearBlock(currentYear + i, (currentIdx + i) * YEAR_HEIGHT);
        }

        for (let [year, block] of activeYears) {
          if (Math.abs(year - currentYear) > 1) {
            observer.unobserve(block);
            block.remove();
            activeYears.delete(year);
          }
        }
        isTicking = false;
      }

      Viewport.addEventListener(
        'scroll',
        () => {
          if (!isTicking) {
            window.requestAnimationFrame(updateInfinite);
            isTicking = true;
          }
        },
        { passive: true }
      );

      function jumpToToday() {
        Viewport.style.scrollBehavior = 'auto';
        Viewport.scrollTop = START_Y;
        setTimeout(() => {
          Viewport.style.scrollBehavior = 'smooth';
        }, 50);
      }

      Viewport.addEventListener('dblclick', jumpToToday);

      Canvas.style.height = `${TOTAL_VIRTUAL_YEARS * YEAR_HEIGHT}px`;
      Viewport.scrollTop = START_Y;
      updateInfinite();

      window.addEventListener('resize', () => {
        // Re-kalkulasi hanya jika lebar layar berubah (menghindari glitch saat URL bar mobile muncul/hilang)
        location.reload();
      });
    </script>
  </body>
</html>
