<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TRACE â€” The Shape of Time</title>
    <style>
      :root {
        --bg: #000;
        --cell-past: #111;
        --cell-future: #080808;
        --accent: #fff; /* Neutral Minimalist */
        --watermark: rgba(255, 255, 255, 0.012);
      }

      body.light-mode {
        --bg: #fafafa;
        --cell-past: #e2e2e2;
        --cell-future: #f0f0f0;
        --accent: #000;
        --watermark: rgba(0, 0, 0, 0.015);
      }

      body,
      html {
        background: var(--bg);
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: background 2s cubic-bezier(0.4, 0, 0.2, 1);
        font-family: 'JetBrains Mono', monospace;
        cursor: none; /* Zero-UI: Cursor diganti oleh interaksi grid */
      }

      #year-watermark {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 40vw;
        font-weight: 900;
        color: var(--watermark);
        pointer-events: none;
        user-select: none;
        z-index: 1;
        letter-spacing: -3vw;
        transition: color 2s ease;
      }

      #seasonal-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 5;
        opacity: 0.3; /* Subtle seasonal presence */
      }

      #viewport {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2;
        opacity: 0;
        transition: opacity 3s ease;
      }

      #grid-container {
        position: relative;
        will-change: transform;
      }

      .day-cell {
        position: absolute;
        border-radius: 0px; /* Honest Feedback: Pure Geometry */
        box-sizing: border-box;
        transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1), background 1.5s ease, opacity 1.5s ease;
      }

      /* Tactile Satisfaction: Hover effect feels heavy and physical */
      .day-cell:hover {
        transform: scale(1.4) !important;
        z-index: 100;
        background: var(--accent) !important;
        opacity: 1 !important;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }

      .day-cell.today {
        background: var(--accent) !important;
        box-shadow: 0 0 40px var(--accent);
        z-index: 10;
      }

      .day-cell.filler {
        border: 0.5px solid var(--watermark);
        background: transparent;
      }

      /* Accessibility: Screen Reader Only */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
    </style>
  </head>
  <body aria-label="Lanskap Waktu TRACE">
    <div id="year-watermark" aria-hidden="true">2026</div>
    <canvas id="seasonal-canvas"></canvas>

    <main id="viewport">
      <div id="grid-container" role="grid" aria-label="Kalender Tahunan"></div>
    </main>

    <div class="sr-only" id="announcer" aria-live="polite"></div>

    <script>
      /**
       * TRACE Core Engine - Manifesto Version
       * Sovereignty: No external dependencies. Pure Logic.
       */
      const container = document.getElementById('grid-container');
      const canvas = document.getElementById('seasonal-canvas');
      const watermark = document.getElementById('year-watermark');
      const viewport = document.getElementById('viewport');
      const announcer = document.getElementById('announcer');
      const ctx = canvas.getContext('2d');

      let state = {
        now: new Date(),
        isLightMode: false,
        particles: [],
      };

      const SEASONS = {
        WINTER: { color: '#E0F7FA', bgDark: '#010409', bgLight: '#F0F4F8' },
        SPRING: { color: '#FFB7C5', bgDark: '#080104', bgLight: '#FFF0F3' },
        SUMMER: { color: '#FFD700', bgDark: '#0A0800', bgLight: '#FFFBEB' },
        AUTUMN: { color: '#E67E22', bgDark: '#0A0502', bgLight: '#FFF5F0' },
      };

      function getSeasonConfig(date) {
        const m = date.getMonth();
        if (m >= 2 && m <= 4) return SEASONS.SPRING;
        if (m >= 5 && m <= 7) return SEASONS.SUMMER;
        if (m >= 8 && m <= 10) return SEASONS.AUTUMN;
        return SEASONS.WINTER;
      }

      function buildLanscape() {
        const year = state.now.getFullYear();
        const isLeap = (year % 4 === 0 && year % 100 !== 0) || year % 400 === 0;
        const actualDays = isLeap ? 366 : 365;
        const todayTime = new Date(year, state.now.getMonth(), state.now.getDate()).getTime();

        watermark.innerText = year;

        // Fluid Geometry: Adaptive to any vessel (screen)
        const vw = window.innerWidth * 0.95;
        const vh = window.innerHeight * 0.95;
        const ratio = vw / vh;
        const cols = Math.ceil(Math.sqrt(actualDays * ratio));
        const rows = Math.ceil(actualDays / cols);
        const totalSlots = cols * rows;
        const startFillerCount = Math.floor((totalSlots - actualDays) / 2);

        const gap = 2; // Minimalist spacing
        const cellSize = Math.min((vw - (cols - 1) * gap) / cols, (vh - (rows - 1) * gap) / rows);

        container.style.width = `${cols * (cellSize + gap) - gap}px`;
        container.style.height = `${rows * (cellSize + gap) - gap}px`;
        container.innerHTML = '';

        const fragment = document.createDocumentFragment();

        for (let i = 0; i < totalSlots; i++) {
          const cell = document.createElement('div');
          const r = Math.floor(i / cols);
          const c = i % cols;

          cell.className = 'day-cell';
          cell.style.width = `${cellSize}px`;
          cell.style.height = `${cellSize}px`;
          cell.style.transform = `translate3d(${c * (cellSize + gap)}px, ${r * (cellSize + gap)}px, 0)`;

          if (i >= startFillerCount && i < startFillerCount + actualDays) {
            const dayIdx = i - startFillerCount;
            const date = new Date(year, 0, 1 + dayIdx);
            const time = date.getTime();

            // Inclusivity: Metadata for Screen Readers
            cell.setAttribute('role', 'gridcell');
            const dateLabel = date.toLocaleDateString('id-ID', {
              weekday: 'long',
              day: 'numeric',
              month: 'long',
              year: 'numeric',
            });
            cell.setAttribute('aria-label', dateLabel);

            if (time === todayTime) {
              cell.classList.add('today');
              announcer.innerText = 'Anda berada di hari ini: ' + dateLabel;
            } else if (time < todayTime) {
              const diff = (todayTime - time) / 86400000;
              cell.style.background = 'var(--cell-past)';
              cell.style.opacity = Math.max(0.08, 1 - diff * 0.0038);
            } else {
              cell.style.background = 'var(--cell-future)';
              cell.style.opacity = '0.12';
            }
          } else {
            cell.classList.add('filler');
            cell.setAttribute('aria-hidden', 'true');
          }
          fragment.appendChild(cell);
        }
        container.appendChild(fragment);
        setTimeout(() => (viewport.style.opacity = '1'), 500);
      }

      // Seasonal Particles: "Digital Furniture" Aesthetics
      function initParticles() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        state.particles = Array.from({ length: 60 }, () => ({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 2 + 1,
          speed: Math.random() * 0.3 + 0.1,
        }));
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const season = getSeasonConfig(state.now);
        ctx.fillStyle = season.color;
        state.particles.forEach((p) => {
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
          p.y += p.speed;
          if (p.y > canvas.height) p.y = -10;
        });
        requestAnimationFrame(draw);
      }

      // Invisible until Necessary: Logic for Simulation & Toggle
      window.addEventListener('keydown', (e) => {
        const key = e.key.toLowerCase();
        if (e.altKey && key === 'r') {
          // Randomize (Simulate Journey)
          state.now = new Date(2026, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28));
          buildLanscape();
        }
        if (e.altKey && key === 'm') {
          // Toggle Mode
          state.isLightMode = !state.isLightMode;
          document.body.classList.toggle('light-mode');
          buildLanscape();
        }
      });

      window.addEventListener('resize', () => {
        initParticles();
        buildLanscape();
      });

      // Initialize Existential State
      initParticles();
      draw();
      buildLanscape();

      console.log('TRACE: Time as a landscape. Exist. Be here now.');
    </script>
  </body>
</html>
